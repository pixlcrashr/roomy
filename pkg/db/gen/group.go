// Code generated by 'gorm.io/cli/gorm'. DO NOT EDIT.

package gen

import (
	"context"
	"strings"

	"github.com/google/uuid"
	"github.com/pixlcrashr/roomy/pkg/db/model"
	"gorm.io/cli/gorm/typed"
	"gorm.io/gorm"
	"gorm.io/gorm/clause"
)

func GroupQuery[T any](db *gorm.DB, opts ...clause.Expression) _GroupQueryInterface[T] {
	return _GroupQueryImpl[T]{
		Interface: typed.G[T](db, opts...),
	}
}

type _GroupQueryInterface[T any] interface {
	typed.Interface[T]
	GetByID(ctx context.Context, id uuid.UUID) (*model.Group, error)
	List(ctx context.Context) ([]*model.Group, error)
	ListDefaultGroups(ctx context.Context) ([]*model.Group, error)
	GetSystemGroup(ctx context.Context) (*model.Group, error)
	Insert(ctx context.Context, id uuid.UUID, name string, description *string, isDefault bool) error
	Save(ctx context.Context, id uuid.UUID, name *string, description *string) error
	SetDefault(ctx context.Context, id uuid.UUID, isDefault bool) error
	Remove(ctx context.Context, id uuid.UUID) error
}

type _GroupQueryImpl[T any] struct {
	typed.Interface[T]
}

func (e _GroupQueryImpl[T]) GetByID(ctx context.Context, id uuid.UUID) (*model.Group, error) {
	var sb strings.Builder
	_params := make([]any, 0, 2)

	sb.WriteString("SELECT * FROM ? WHERE id = ?")
	_params = append(_params, clause.Table{Name: clause.CurrentTable}, id)

	var result *model.Group
	err := e.Raw(sb.String(), _params...).Scan(ctx, &result)
	return result, err
}

func (e _GroupQueryImpl[T]) List(ctx context.Context) ([]*model.Group, error) {
	var sb strings.Builder
	_params := make([]any, 0, 1)

	sb.WriteString("SELECT * FROM ? ORDER BY created_at DESC")
	_params = append(_params, clause.Table{Name: clause.CurrentTable})

	var result []*model.Group
	err := e.Raw(sb.String(), _params...).Scan(ctx, &result)
	return result, err
}

func (e _GroupQueryImpl[T]) ListDefaultGroups(ctx context.Context) ([]*model.Group, error) {
	var sb strings.Builder
	_params := make([]any, 0, 1)

	sb.WriteString("SELECT * FROM ? WHERE is_default = true")
	_params = append(_params, clause.Table{Name: clause.CurrentTable})

	var result []*model.Group
	err := e.Raw(sb.String(), _params...).Scan(ctx, &result)
	return result, err
}

func (e _GroupQueryImpl[T]) GetSystemGroup(ctx context.Context) (*model.Group, error) {
	var sb strings.Builder
	_params := make([]any, 0, 1)

	sb.WriteString("SELECT * FROM ? WHERE is_system = true")
	_params = append(_params, clause.Table{Name: clause.CurrentTable})

	var result *model.Group
	err := e.Raw(sb.String(), _params...).Scan(ctx, &result)
	return result, err
}

func (e _GroupQueryImpl[T]) Insert(ctx context.Context, id uuid.UUID, name string, description *string, isDefault bool) error {
	var sb strings.Builder
	_params := make([]any, 0, 5)

	sb.WriteString("INSERT INTO ? (id, name, description, is_system, is_default, created_at, updated_at)")
	_params = append(_params, clause.Table{Name: clause.CurrentTable})
	sb.WriteString(" VALUES (?, ?, ?, false, ?, NOW(), NOW())")
	_params = append(_params, id, name, description, isDefault)

	return e.Exec(ctx, sb.String(), _params...)
}

func (e _GroupQueryImpl[T]) Save(ctx context.Context, id uuid.UUID, name *string, description *string) error {
	var sb strings.Builder
	_params := make([]any, 0, 4)

	sb.WriteString("UPDATE ?")
	_params = append(_params, clause.Table{Name: clause.CurrentTable})
	{
		var tmp strings.Builder
		if name != nil {
			tmp.WriteString(" name = ?,")
			_params = append(_params, name)
		}
		if description != nil {
			tmp.WriteString(" description = ?,")
			_params = append(_params, description)
		}
		tmp.WriteString(" updated_at = NOW()")
		c := strings.TrimSpace(tmp.String())
		if c != "" {
			c = strings.Trim(c, ", ")
			sb.WriteString(" SET ")
			sb.WriteString(c)
		}
	}
	sb.WriteString(" WHERE id = ? AND is_system = false")
	_params = append(_params, id)

	return e.Exec(ctx, sb.String(), _params...)
}

func (e _GroupQueryImpl[T]) SetDefault(ctx context.Context, id uuid.UUID, isDefault bool) error {
	var sb strings.Builder
	_params := make([]any, 0, 3)

	sb.WriteString("UPDATE ? SET is_default = ?, updated_at = NOW() WHERE id = ?")
	_params = append(_params, clause.Table{Name: clause.CurrentTable}, isDefault, id)

	return e.Exec(ctx, sb.String(), _params...)
}

func (e _GroupQueryImpl[T]) Remove(ctx context.Context, id uuid.UUID) error {
	var sb strings.Builder
	_params := make([]any, 0, 2)

	sb.WriteString("DELETE FROM ? WHERE id = ? AND is_system = false")
	_params = append(_params, clause.Table{Name: clause.CurrentTable}, id)

	return e.Exec(ctx, sb.String(), _params...)
}
