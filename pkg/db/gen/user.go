// Code generated by 'gorm.io/cli/gorm'. DO NOT EDIT.

package gen

import (
	"context"
	"regexp"
	"strings"

	"github.com/google/uuid"
	"github.com/pixlcrashr/roomy/pkg/db/model"
	"gorm.io/cli/gorm/typed"
	"gorm.io/gorm"
	"gorm.io/gorm/clause"
)

func UserQuery[T any](db *gorm.DB, opts ...clause.Expression) _UserQueryInterface[T] {
	return _UserQueryImpl[T]{
		Interface: typed.G[T](db, opts...),
	}
}

type _UserQueryInterface[T any] interface {
	typed.Interface[T]
	GetByID(ctx context.Context, id uuid.UUID) (*model.User, error)
	GetByEmail(ctx context.Context, email string) (*model.User, error)
	GetByOAuth(ctx context.Context, provider string, oauthID string) (*model.User, error)
	List(ctx context.Context, limit int, offset int, search *string, isActive *bool) ([]*model.User, error)
	CountAll(ctx context.Context, search *string, isActive *bool) (int64, error)
	Insert(ctx context.Context, id uuid.UUID, email string, username string, name string, profilePicture *string, oauthProvider string, oauthID string) error
	Save(ctx context.Context, id uuid.UUID, name *string, username *string, profilePicture *string) error
	UpdateNotificationPreferences(ctx context.Context, id uuid.UUID, notifyReservationConfirmed *bool, notifyReservationCancelled *bool, notifyReservationReminder *bool, reminderMinutesBefore *int, notifyCheckInWarning *bool) error
	Enable(ctx context.Context, id uuid.UUID) error
	Disable(ctx context.Context, id uuid.UUID) error
	Remove(ctx context.Context, id uuid.UUID) error
}

type _UserQueryImpl[T any] struct {
	typed.Interface[T]
}

func (e _UserQueryImpl[T]) GetByID(ctx context.Context, id uuid.UUID) (*model.User, error) {
	var sb strings.Builder
	_params := make([]any, 0, 2)

	sb.WriteString("SELECT * FROM ? WHERE id = ?")
	_params = append(_params, clause.Table{Name: clause.CurrentTable}, id)

	var result *model.User
	err := e.Raw(sb.String(), _params...).Scan(ctx, &result)
	return result, err
}

func (e _UserQueryImpl[T]) GetByEmail(ctx context.Context, email string) (*model.User, error) {
	var sb strings.Builder
	_params := make([]any, 0, 2)

	sb.WriteString("SELECT * FROM ? WHERE email = ?")
	_params = append(_params, clause.Table{Name: clause.CurrentTable}, email)

	var result *model.User
	err := e.Raw(sb.String(), _params...).Scan(ctx, &result)
	return result, err
}

func (e _UserQueryImpl[T]) GetByOAuth(ctx context.Context, provider string, oauthID string) (*model.User, error) {
	var sb strings.Builder
	_params := make([]any, 0, 3)

	sb.WriteString("SELECT * FROM ? WHERE oauth_provider = ? AND oauth_id = ?")
	_params = append(_params, clause.Table{Name: clause.CurrentTable}, provider, oauthID)

	var result *model.User
	err := e.Raw(sb.String(), _params...).Scan(ctx, &result)
	return result, err
}

func (e _UserQueryImpl[T]) List(ctx context.Context, limit int, offset int, search *string, isActive *bool) ([]*model.User, error) {
	var sb strings.Builder
	_params := make([]any, 0, 7)

	sb.WriteString("SELECT * FROM ?")
	_params = append(_params, clause.Table{Name: clause.CurrentTable})
	{
		var tmp strings.Builder
		if search != nil {
			tmp.WriteString(" (name ILIKE ? OR email ILIKE ? OR username ILIKE ?)")
			_params = append(_params, search, search, search)
		}
		if isActive != nil {
			tmp.WriteString(" AND is_active = ?")
			_params = append(_params, isActive)
		}
		c := strings.TrimSpace(tmp.String())
		if c != "" {
			reTrim := regexp.MustCompile(`(?i)^\s*(?:and|or)\s+|\s+(?:and|or)\s*$`)
			c = reTrim.ReplaceAllString(c, "")
			sb.WriteString(" WHERE ")
			sb.WriteString(c)
		}
	}
	sb.WriteString(" ORDER BY created_at DESC")
	sb.WriteString(" LIMIT ? OFFSET ?")
	_params = append(_params, limit, offset)

	var result []*model.User
	err := e.Raw(sb.String(), _params...).Scan(ctx, &result)
	return result, err
}

func (e _UserQueryImpl[T]) CountAll(ctx context.Context, search *string, isActive *bool) (int64, error) {
	var sb strings.Builder
	_params := make([]any, 0, 5)

	sb.WriteString("SELECT COUNT(*) FROM ?")
	_params = append(_params, clause.Table{Name: clause.CurrentTable})
	{
		var tmp strings.Builder
		if search != nil {
			tmp.WriteString(" (name ILIKE ? OR email ILIKE ? OR username ILIKE ?)")
			_params = append(_params, search, search, search)
		}
		if isActive != nil {
			tmp.WriteString(" AND is_active = ?")
			_params = append(_params, isActive)
		}
		c := strings.TrimSpace(tmp.String())
		if c != "" {
			reTrim := regexp.MustCompile(`(?i)^\s*(?:and|or)\s+|\s+(?:and|or)\s*$`)
			c = reTrim.ReplaceAllString(c, "")
			sb.WriteString(" WHERE ")
			sb.WriteString(c)
		}
	}

	var result int64
	err := e.Raw(sb.String(), _params...).Scan(ctx, &result)
	return result, err
}

func (e _UserQueryImpl[T]) Insert(ctx context.Context, id uuid.UUID, email string, username string, name string, profilePicture *string, oauthProvider string, oauthID string) error {
	var sb strings.Builder
	_params := make([]any, 0, 8)

	sb.WriteString("INSERT INTO ? (")
	_params = append(_params, clause.Table{Name: clause.CurrentTable})
	sb.WriteString(" id, email, username, name, profile_picture, oauth_provider, oauth_id,")
	sb.WriteString(" is_active, notify_reservation_confirmed, notify_reservation_cancelled,")
	sb.WriteString(" notify_reservation_reminder, reminder_minutes_before, notify_check_in_warning,")
	sb.WriteString(" created_at, updated_at")
	sb.WriteString(" ) VALUES (")
	sb.WriteString(" ?, ?, ?, ?, ?, ?, ?,")
	_params = append(_params, id, email, username, name, profilePicture, oauthProvider, oauthID)
	sb.WriteString(" true, true, true, true, 15, true, NOW(), NOW()")
	sb.WriteString(" )")

	return e.Exec(ctx, sb.String(), _params...)
}

func (e _UserQueryImpl[T]) Save(ctx context.Context, id uuid.UUID, name *string, username *string, profilePicture *string) error {
	var sb strings.Builder
	_params := make([]any, 0, 5)

	sb.WriteString("UPDATE ?")
	_params = append(_params, clause.Table{Name: clause.CurrentTable})
	{
		var tmp strings.Builder
		if name != nil {
			tmp.WriteString(" name = ?,")
			_params = append(_params, name)
		}
		if username != nil {
			tmp.WriteString(" username = ?,")
			_params = append(_params, username)
		}
		if profilePicture != nil {
			tmp.WriteString(" profile_picture = ?,")
			_params = append(_params, profilePicture)
		}
		tmp.WriteString(" updated_at = NOW()")
		c := strings.TrimSpace(tmp.String())
		if c != "" {
			c = strings.Trim(c, ", ")
			sb.WriteString(" SET ")
			sb.WriteString(c)
		}
	}
	sb.WriteString(" WHERE id = ?")
	_params = append(_params, id)

	return e.Exec(ctx, sb.String(), _params...)
}

func (e _UserQueryImpl[T]) UpdateNotificationPreferences(ctx context.Context, id uuid.UUID, notifyReservationConfirmed *bool, notifyReservationCancelled *bool, notifyReservationReminder *bool, reminderMinutesBefore *int, notifyCheckInWarning *bool) error {
	var sb strings.Builder
	_params := make([]any, 0, 7)

	sb.WriteString("UPDATE ?")
	_params = append(_params, clause.Table{Name: clause.CurrentTable})
	{
		var tmp strings.Builder
		if notifyReservationConfirmed != nil {
			tmp.WriteString(" notify_reservation_confirmed = ?,")
			_params = append(_params, notifyReservationConfirmed)
		}
		if notifyReservationCancelled != nil {
			tmp.WriteString(" notify_reservation_cancelled = ?,")
			_params = append(_params, notifyReservationCancelled)
		}
		if notifyReservationReminder != nil {
			tmp.WriteString(" notify_reservation_reminder = ?,")
			_params = append(_params, notifyReservationReminder)
		}
		if reminderMinutesBefore != nil {
			tmp.WriteString(" reminder_minutes_before = ?,")
			_params = append(_params, reminderMinutesBefore)
		}
		if notifyCheckInWarning != nil {
			tmp.WriteString(" notify_check_in_warning = ?,")
			_params = append(_params, notifyCheckInWarning)
		}
		tmp.WriteString(" updated_at = NOW()")
		c := strings.TrimSpace(tmp.String())
		if c != "" {
			c = strings.Trim(c, ", ")
			sb.WriteString(" SET ")
			sb.WriteString(c)
		}
	}
	sb.WriteString(" WHERE id = ?")
	_params = append(_params, id)

	return e.Exec(ctx, sb.String(), _params...)
}

func (e _UserQueryImpl[T]) Enable(ctx context.Context, id uuid.UUID) error {
	var sb strings.Builder
	_params := make([]any, 0, 2)

	sb.WriteString("UPDATE ? SET is_active = true, updated_at = NOW() WHERE id = ?")
	_params = append(_params, clause.Table{Name: clause.CurrentTable}, id)

	return e.Exec(ctx, sb.String(), _params...)
}

func (e _UserQueryImpl[T]) Disable(ctx context.Context, id uuid.UUID) error {
	var sb strings.Builder
	_params := make([]any, 0, 2)

	sb.WriteString("UPDATE ? SET is_active = false, updated_at = NOW() WHERE id = ?")
	_params = append(_params, clause.Table{Name: clause.CurrentTable}, id)

	return e.Exec(ctx, sb.String(), _params...)
}

func (e _UserQueryImpl[T]) Remove(ctx context.Context, id uuid.UUID) error {
	var sb strings.Builder
	_params := make([]any, 0, 2)

	sb.WriteString("DELETE FROM ? WHERE id = ?")
	_params = append(_params, clause.Table{Name: clause.CurrentTable}, id)

	return e.Exec(ctx, sb.String(), _params...)
}
