// Code generated by 'gorm.io/cli/gorm'. DO NOT EDIT.

package generated

import (
	"context"
	"regexp"
	"strings"
	"time"

	"github.com/google/uuid"
	"github.com/pixlcrashr/roomy/pkg/db/model"
	"gorm.io/cli/gorm/typed"
	"gorm.io/gorm"
	"gorm.io/gorm/clause"
)

func ExampleQuery[T any](db *gorm.DB, opts ...clause.Expression) _ExampleQueryInterface[T] {
	return _ExampleQueryImpl[T]{
		Interface: typed.G[T](db, opts...),
	}
}

type _ExampleQueryInterface[T any] interface {
	typed.Interface[T]
	List(ctx context.Context, limit int, offset int, eventSchemaID *uuid.UUID, processedAt *time.Time, eventID *uuid.UUID, eventCustomID *string, startDate *time.Time, endDate *time.Time) ([]*model.Example, error)
}

type _ExampleQueryImpl[T any] struct {
	typed.Interface[T]
}

func (e _ExampleQueryImpl[T]) List(ctx context.Context, limit int, offset int, eventSchemaID *uuid.UUID, processedAt *time.Time, eventID *uuid.UUID, eventCustomID *string, startDate *time.Time, endDate *time.Time) ([]*model.Example, error) {
	var sb strings.Builder
	_params := make([]any, 0, 9)

	sb.WriteString("SELECT ei.* FROM ? ei")
	_params = append(_params, clause.Table{Name: clause.CurrentTable})
	sb.WriteString(" LEFT JOIN event_schemas es ON es.id = ei.event_schema_id")
	sb.WriteString(" LEFT JOIN events e ON e.id = es.event_id")
	{
		var tmp strings.Builder
		if eventSchemaID != nil {
			tmp.WriteString(" ei.event_schema_id = ?")
			_params = append(_params, eventSchemaID)
		}
		if processedAt != nil {
			tmp.WriteString(" AND ei.processed_at = ?")
			_params = append(_params, processedAt)
		}
		if eventID != nil {
			tmp.WriteString(" AND es.event_id = ?")
			_params = append(_params, eventID)
		}
		if eventCustomID != nil {
			tmp.WriteString(" AND e.custom_id = ?")
			_params = append(_params, eventCustomID)
		}
		if startDate != nil {
			tmp.WriteString(" AND ei.created_at >= ?")
			_params = append(_params, startDate)
		}
		if endDate != nil {
			tmp.WriteString(" AND ei.created_at <= ?")
			_params = append(_params, endDate)
		}
		c := strings.TrimSpace(tmp.String())
		if c != "" {
			reTrim := regexp.MustCompile(`(?i)^\s*(?:and|or)\s+|\s+(?:and|or)\s*$`)
			c = reTrim.ReplaceAllString(c, "")
			sb.WriteString(" WHERE ")
			sb.WriteString(c)
		}
	}
	sb.WriteString(" ORDER BY ei.created_at DESC")
	sb.WriteString(" LIMIT ? OFFSET ?")
	_params = append(_params, limit, offset)

	var result []*model.Example
	err := e.Raw(sb.String(), _params...).Scan(ctx, &result)
	return result, err
}
